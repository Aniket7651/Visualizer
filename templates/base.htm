<!-- templates/map.html -->
{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="title-section">ICPC - International Cancer Patient Coalition</title>
    <link rel="stylesheet" href="{% static 'admin/css/styles.css' %}">
    <link href="https://fonts.googleapis.com/css?family=Poppins" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }

        .tab {
            color: black;
        }

        [data-tab-info] {
            display: none;
        }

        .active[data-tab-info] {
            display: block;
        }

        .map-buttons button {
            margin: 5px;
            padding: 10px;
            cursor: pointer;
        }

        .map-buttons button.active {
            background-color: #604eb1;
            color: white;
        }
    </style>
</head>

<body>
    <header>
        <div class="logo">
            <img src="{% static 'admin/img/ICPClogo.jpg' %}" alt="ICPC Logo">
            <span>ICPC</span>
            <span class="subtitle">International Cancer Patient Coalition</span>
        </div>
        <nav>
            <a href="{% url 'infra' %}">Home</a>
            <a href="#">Data</a>
            <a href="#">About</a>
            <a href="#">Help</a>
        </nav>
    </header>
    <section class="filter">
        <form method="post">
            {% csrf_token %}
            <select name="cancerType" id="cancerType">
                <option value="BreastCancer" selected>Breast Cancer</option>
                <option value="ColorectalCancer">Colorectal Cancer</option>
                <option value="ProstateCancer">Prostate Cancer</option>
            </select>
            <button type="submit">Submit</button>
        </form>
    </section>

    <main>
        <h1>Breast Cancer Factsheet: Insights & Key Developments</h1>
        <p>This factsheet provides a comprehensive overview of key pillars shaping breast cancer care, including
            specialised infrastructure, treatment accessibility, research funding, early detection, and palliative care.
        </p>

        <div class="tabs">
            <span class="tab" data-tab-value="#tab_1">Infrastructure</span>
            <span class="tab" data-tab-value="#tab_2">Cancer Screening</span>
            <span class="tab" data-tab-value="#tab_3">Reimbursement</span>
            <span class="tab" data-tab-value="#tab_4">Utilisation of Biomarker</span>
            <span class="tab" data-tab-value="#tab_5">Clinical Guidelines</span>
            <span class="tab" data-tab-value="#tab_6">Care & Diagnosis</span>
            <span class="tab" data-tab-value="#tab_7">Treatment Funding & Awareness</span>
        </div>
        <div class="tab-content">
            <div class="content tabs__tab active" id="tab_1" data-tab-info>
                <h2>Infrastructure</h2>
                <div class="row">
                    <div class="cont">
                        <div class="column">
                            <h3>Strengths</h3>
                            <p>Centers like INCan and Hospital General de Mexico provide high-quality care in major
                                cities. HER2, ER, and PR testing are available in the tertiary hospitals and integrated
                                into standard care.</p>
                            <h3>Opportunities</h3>
                            <p>Expand regional cancer centers and public investment in pathology. Improve access to BRCA
                                and molecular testing beyond private sector availability.</p>
                        </div>
                        <div class="column">
                            <h3>Weaknesses</h3>
                            <p>Only ~35% of cancer patients access specialised centers; most rely on general hospitals
                                with limited oncology capacity. Pathology and genetic testing infrastructure is
                                underdeveloped in the public sector.</p>
                            <h3>Threats</h3>
                            <p>Rural and low-income patients are at risk of delayed diagnosis and under-treatment due to
                                lack of infrastructure.</p>
                        </div>
                    </div>

                    <!-- Map section -->
                    <div class="map">
                        <div>
                            {% if map_type == 'sc' %}
                                <h2>Specialized Canters</h2>
                            {% elif map_type == 'gm' %}
                                <h2>Genetic & Molecular Testing</h2>
                            {% else %}
                                <h2>Specialized Canters</h2>
                            {% endif %}
                        </div>
                        <div id="geoChangable" style="height: fit-content;">
                            {% if geomap %}
                            {{ geomap|safe }}
                            {% else %}
                            <div>No map data available</div>
                            {% endif %}
                        </div>
                        <div class="map-buttons">
                            <form method="get" action="{% url 'infra' %}" style="display: inline;">
                                <input type="hidden" name="map_type" value="sc">
                                <button type="submit" {% if map_type == 'sc' %}class="active"{% endif %}>Specialized Centers</button>
                            </form>
                            <form method="get" action="{% url 'infra' %}" style="display: inline;">
                                <input type="hidden" name="map_type" value="gm">
                                <button type="submit" {% if map_type == 'gm' %}class="active"{% endif %}>Genetic & Molecular Testing</button>
                            </form>
                        </div>
                        <div class="map-icons">
                            <span><i class='fa fa-globe' style="font-size: 1.8rem;"></i></span>
                            <span><i class="fa fa-bar-chart" style="font-size: 1.8rem;"></i></span>
                            <span><i class="fa fa-download" style="font-size: 1.8rem;"></i></span>
                            <span><i class="fa fa-info" style="font-size: 1.8rem;"></i></span>
                        </div>
                    </div>
                </div>

                <div class="chart-section">
                    <h2 style="color: #604eb1;">Overall Average Design</h2>
                    <div class="chart-wrapper">
                        <div id="scatter-chart" style="width: 100%;"></div>
                        <div class="chart-icons">
                            <span><i class='fa fa-globe'></i></span>
                            <span><i class="fa fa-bar-chart"></i></span>
                            <span><i class="fa fa-download"></i></span>
                            <span><i class="fa fa-info"></i></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab 4 (Utilization of Biomarkers, keep as is) -->
            <div class="content tabs__tab" id="tab_4" data-tab-info>
                <h2>Utilization of Biomarkers</h2>
                <div class="row">
                    <div class="cont">
                        <div class="column">
                            <h3>Strengths</h3>
                            <p>HER2, ER, and PR testing are part of institutional care standards. Testing is
                                increasingly recognized in national clinical workflows</p>
                            <h3>Opportunities</h3>
                            <p>Standardize and reimburse HER2 and BRCA testing across public providers. Develop
                                centralized labs to improve equity and efficiency.</p>
                        </div>
                        <div class="column">
                            <h3>Weaknesses</h3>
                            <p>BRCA testing is cost-prohibitive ($800-$2,500 USD) and not reimbursed in the public
                                system. Turnaround times are long due to limited pathology capacity in public hospitals.
                            </p>
                            <h3>Threats</h3>
                            <p>Unequal access to biomarker data undermines personalized treatment plans and precision
                                care.</p>
                        </div>
                    </div>

                    <div class="map">
                        <div id="geo_map" style="width: 100%;"></div>
                        <div class="map-buttons">
                            <button onclick="changeMap('her')">HER2</button>
                            <button onclick="changeMap('er')">ER</button>
                            <button onclick="changeMap('pr')">PR</button>
                            <button onclick="changeMap('brca1')">BRCA1</button>
                            <button onclick="changeMap('brca2')">BRCA2</button>
                        </div>
                        <div class="map-icons">
                            <span><i class='fa fa-globe'></i></span>
                            <span><i class="fa fa-bar-chart"></i></span>
                            <span><i class="fa fa-download"></i></span>
                            <span><i class="fa fa-info"></i></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Tab switching script (keep as is) -->
    <script>
        const tabs = document.querySelectorAll('[data-tab-value]');
        const tabInfos = document.querySelectorAll('[data-tab-info]');
        const title = document.getElementById('title-section');

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const target = document.querySelector(tab.dataset.tabValue);
                tabInfos.forEach(tabInfo => {
                    tabInfo.classList.remove('active');
                });
                title.innerText = 'ICPC - ' + target.querySelector('h2').innerText;
                target.classList.add('active');
            });
        });
    </script>

    <!-- Google Charts script (keep as is) -->
    <script>
        google.charts.load('current', { packages: ['corechart'] });
        google.charts.setOnLoadCallback(drawChart);

        function drawChart() {
            var data = google.visualization.arrayToDataTable([
                ['Country', 'Avg'],
                ['Germany', 2.00],
                ['United States', 3.00],
                ['Brazil', 4.00],
                ['Canada', 5.00],
                ['France', 4.00],
                ['Russia', 2.00],
                ['India', 1.00],
                ['China', 5.00],
                ['Italy', 1.00],
                ['Spain', 1.00],
                ['United Kingdom', 2.00],
                ['Australia', 3.00],
                ['Japan', 4.00],
                ['South Korea', 5.00],
                ['Mexico', 1.00],
                ['Argentina', 1.00],
                ['South Africa', 1.00],
                ['Egypt', 1.00],
                ['Turkey', 2.00]
            ]);

            var options = {
                title: 'Overall Average of Infrastructure',
                legend: 'none',
                hAxis: {
                    title: 'Country',
                    textStyle: { fontSize: 10 },
                    slantedText: true,
                    slantedTextAngle: 45
                },
                vAxis: {
                    title: 'Avg',
                    gridlines: { count: 5 }
                },
                backgroundColor: '#f0f0f0',
                colors: ['#003087'],
                pointSize: 8,
                pointShape: { type: 'circle' },
                height: 500,
            };

            var chartscatter = new google.visualization.ScatterChart(document.getElementById('scatter-chart'));
            chartscatter.draw(data, options);
        }
    </script>

    <footer>
        <div class="footer-content">
            <div class="logo">
                <img src="{% static 'admin/img/ICPClogo.jpg' %}" alt="ICPC Logo">
                <span>ICPC -</span>
                <span class="subtitle"> - International Cancer Patient Coalition</span>
            </div>
            <div class="links">
                <a href="#">Contact Us</a>
                <a href="#">Privacy Policy</a>
                <a href="#">About ICPC</a>
            </div>
        </div>
    </footer>
</body>

</html>